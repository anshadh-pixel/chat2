<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>1:1 ചാറ്റ് ആപ്പ്</title>
  <style>
    body {
      font-family: sans-serif;
      background: linear-gradient(to right, #c2e9fb, #a1c4fd);
    }
    #login, #chat {
      max-width: 400px;
      margin: 80px auto;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    #chat { display: none; }
    ul { list-style: none; padding: 0; max-height: 300px; overflow-y: auto; }
    li { margin-bottom: 10px; padding: 10px; border-radius: 8px; }
    .sent { background: #d0ffd0; text-align: right; }
    .received { background: #d0d0ff; text-align: left; }
    input, select, button {
      margin-top: 10px;
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button { background: #007bff; color: white; cursor: pointer; border: none; }
  </style>
</head>
<body>

<div id="login">
  <h2>ലോഗിൻ</h2>
  <input id="username" placeholder="ഉപയോക്താവിന്റെ പേര് നൽകുക (UserA / UserB)" />
  <button onclick="login()">Login</button>
</div>

<div id="chat">
  <h3 id="welcome"></h3>
  <label>എവർക്കാണ് അയക്കേണ്ടത്:</label>
  <select id="userList"></select><br><br>
  <ul id="messages"></ul>
  <input id="msg" placeholder="മെസ്സേജ് ടൈപ്പ് ചെയ്യൂ..." />
  <button onclick="send()">അയയ്ക്കുക</button>
</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
  // ✅ Renderil ullathaya backend connect cheyyuka
  const socket = io("https://chat2-2-y9e9.onrender.com");
  let myUsername = '';

  function login() {
    const username = document.getElementById('username').value.trim();
    if (!username) return alert('പേര് നൽകുക');
    socket.emit('login', username);
  }

  socket.on('login_success', (users) => {
    document.getElementById('login').style.display = 'none';
    document.getElementById('chat').style.display = 'block';
    myUsername = document.getElementById('username').value;
    document.getElementById('welcome').innerText = സ്വാഗതം, ${myUsername}!;

    const userList = document.getElementById('userList');
    userList.innerHTML = '';
    users.forEach(u => {
      if (u !== myUsername) {
        const opt = document.createElement('option');
        opt.value = u;
        opt.innerText = u;
        userList.appendChild(opt);
      }
    });
  });

  function send() {
    const to = document.getElementById('userList').value;
    const message = document.getElementById('msg').value.trim();
    if (!message || !to) return;
    socket.emit('send_private', { to, message });

    const li = document.createElement('li');
    li.classList.add('sent');
    li.innerText = നീ ${to}-ന്: ${message};
    document.getElementById('messages').appendChild(li);
    document.getElementById('msg').value = '';
  }

  socket.on('receive_private', function(data) {
    const li = document.createElement('li');
    li.classList.add('received');
    li.innerText = data.from + ": " + data.message;
    document.getElementById('messages').appendChild(li);
  });
</script>

</body>
</html>
